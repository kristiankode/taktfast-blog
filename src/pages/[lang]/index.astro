---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";

export async function getStaticPaths() {
  return [{ params: { lang: "en" } }, { params: { lang: "no" } }];
}

const { lang } = Astro.params;
const langKey = (lang === "no" ? "no" : "en") as "en" | "no";
const locale = langKey === "no" ? "nn-NO" : "en-US";
const isNorwegian = langKey === "no";
const posts = (
  await getCollection("blog", ({ data }) => data.locale === langKey)
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const heroTitle = isNorwegian ? "Musikkverktøy og tips" : "Music Tools & Tips";
const heroDescription = isNorwegian
  ? "Praktiske guider for musikarar. Lær å lage akkordskjema, arrangere låtar, og få meir ut av bandøvinga."
  : "Practical guides for musicians. Learn how to create chord charts, arrange songs, and make the most of your band practice.";
const latestTitle = isNorwegian ? "Siste innlegg" : "Latest Posts";
const metaDescription = isNorwegian
  ? "Tips, verktøy og korte guider for musikarar — frå akkordskjema til låtstruktur og bandøving."
  : SITE_DESCRIPTION;
const alternateHref = isNorwegian ? "/en/" : "/no/";
const blogBase = isNorwegian ? "/no/blog" : "/en/blog";
---

<!doctype html>
<html lang={langKey}>
  <head>
    <BaseHead title={SITE_TITLE} description={metaDescription} />
    <link
      rel="alternate"
      hreflang={isNorwegian ? "en" : "no"}
      href={alternateHref}
    />
  </head>
  <body>
    <Header lang={langKey} />
    <main>
      <section class="hero">
        <h1>{heroTitle}</h1>
        <p>{heroDescription}</p>
      </section>
      <section>
        <h2>{latestTitle}</h2>
        <ul>
          {
            posts.map((post) => (
              <li>
                <a href={`${blogBase}/${post.data.translationKey}/`}>
                  <h4 class="title">{post.data.title}</h4>
                  <p class="date">
                    <FormattedDate date={post.data.pubDate} locale={locale} />
                  </p>
                  <p class="description">{post.data.description}</p>
                </a>
              </li>
            ))
          }
        </ul>
      </section>
    </main>
    <Footer />
  </body>
</html>

<style>
  .hero {
    text-align: center;
    margin-bottom: 2em;
  }
  .hero h1 {
    margin-bottom: 0.25em;
    letter-spacing: -0.03em;
  }
  .hero p {
    color: rgba(71, 85, 105, 1);
    font-size: 1.1em;
  }
  h2 {
    margin-bottom: 1em;
    font-size: 1.4em;
    letter-spacing: -0.01em;
  }
  ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 1em;
  }
  ul li a {
    display: block;
    padding: 1.5em;
    background: var(--glass-bg-strong);
    backdrop-filter: var(--glass-blur);
    -webkit-backdrop-filter: var(--glass-blur);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    text-decoration: none;
    box-shadow: var(--shadow-sm);
    transition: all 0.15s ease;
  }
  ul li a:hover {
    box-shadow: var(--shadow-md);
    border-color: var(--border-card);
  }
  .title {
    margin: 0 0 0.25em 0;
    color: rgba(15, 23, 42, 1);
    letter-spacing: -0.01em;
  }
  .date {
    margin: 0 0 0.5em 0;
    color: rgba(71, 85, 105, 1);
    font-size: 0.8em;
  }
  .description {
    margin: 0;
    color: rgba(71, 85, 105, 1);
    font-size: 0.9em;
    line-height: 1.5;
  }
</style>
