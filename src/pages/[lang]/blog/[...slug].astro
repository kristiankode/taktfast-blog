---
import { type CollectionEntry, getCollection, render } from "astro:content";
import BlogPost from "../../../layouts/BlogPost.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts.map((post) => {
    const alternates = posts
      .filter(
        (entry) =>
          entry.data.translationKey === post.data.translationKey &&
          entry.data.locale !== post.data.locale,
      )
      .map((entry) => ({
        locale: entry.data.locale,
        label: entry.data.locale === "no" ? "Norsk" : "English",
        href: `/${entry.data.locale}/blog/${entry.data.translationKey}/`,
      }));

    const languageLinks = [
      {
        locale: post.data.locale,
        label: post.data.locale === "no" ? "Norsk" : "English",
        href: `/${post.data.locale}/blog/${post.data.translationKey}/`,
      },
      ...alternates,
    ];

    return {
      params: { lang: post.data.locale, slug: post.data.translationKey },
      props: { post, alternates, languageLinks },
    };
  });
}

type LanguageLink = {
  label: string;
  href: string;
  locale: "en" | "no";
};

type Props = {
  post: CollectionEntry<"blog">;
  alternates: LanguageLink[];
  languageLinks: LanguageLink[];
};

const { post, alternates, languageLinks } = Astro.props;
const { Content } = await render(post);
---

<BlogPost
  {...post.data}
  lang={post.data.locale}
  alternateLinks={alternates}
  languageLinks={languageLinks}
>
  <Content />
</BlogPost>
